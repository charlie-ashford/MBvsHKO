<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MrBeast vs Hamster Kombat</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/odometer.js/0.4.8/themes/odometer-theme-minimal.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        font-family: "Inter", sans-serif;
        background-color: #121212;
        color: #e0e0e0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        text-align: center;
      }

      .channels {
        display: flex;
        width: 100%;
        justify-content: space-around;
        gap: 20px;
        flex-wrap: wrap;
        transition: transform 0.3s ease;
        padding: 20px;
        box-sizing: border-box;
      }

      .gains {
        font-size: 36px;
        font-weight: bold;
      }
      .gains-text {
        font-size: 36px;
        font-weight: bold;
      }

      .channel {
        flex: 1;
        min-width: 250px;
        padding: 20px;
        background-color: #1e1e1e;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        margin-bottom: 20px;
        position: relative;
        transition: transform 0.3s ease, width 0.3s ease, height 0.3s ease;
        transform-origin: center center;
        border: 3px solid transparent;
      }

      .channel:hover:not(.fullscreen) {
        transform: scale(1.05);
      }

      .fullscreen-mode .channel:not(.fullscreen) {
        display: none;
      }

      .fullscreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #1e1e1e;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        overflow: auto;
        box-sizing: border-box;
      }

      .fullscreen .odometer,
      .fullscreen h2 {
        font-size: 48px;
      }

      .fullscreen img {
        width: 150px;
        height: 150px;
      }

      .fullscreen canvas {
        opacity: 0.5;
      }

      .fullscreen .back-button {
        pointer-events: auto;
      }

      .back-button {
        position: absolute;
        top: 30px;
        left: 30px;
        background-color: rgba(255, 255, 255, 0.15);
        color: #ffffff;
        border: none;
        padding: 12px 24px;
        cursor: pointer;
        border-radius: 30px;
        font-size: 18px;
        font-weight: bold;
        z-index: 1001;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .back-button:hover {
        background-color: rgba(255, 255, 255, 0.25);
        transform: scale(1.05) translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
      }

      .back-button:active {
        transform: scale(0.98) translateY(1px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .back-button::before {
        content: "‚Üê";
        margin-right: 8px;
        font-size: 24px;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      a {
        text-decoration: none;
        color: inherit;
        cursor: default;
        pointer-events: none;
      }

      .modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        background-color: #1e1e1e;
        border: 3px solid transparent;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        padding: 40px;
        z-index: 2000;
        text-align: center;
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
      }

      .modal.visible {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }

      .modal h2 {
        margin: 0 0 20px;
      }

      .modal-buttons {
        display: flex;
        justify-content: space-around;
        margin-top: 20px;
      }

      .modal-button {
        background-color: rgba(255, 255, 255, 0.15);
        color: #ffffff;
        border: none;
        padding: 12px 24px;
        cursor: pointer;
        border-radius: 30px;
        font-size: 18px;
        font-weight: bold;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .modal-button:hover {
        background-color: rgba(255, 255, 255, 0.25);
        transform: scale(1.05) translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
      }

      .modal-button:active {
        transform: scale(0.98) translateY(1px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .channel canvas {
        position: absolute;
        top: 20px;
        left: 20px;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        z-index: 0;
      }

      img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin-bottom: 15px;
        border: 5px solid #333;
        position: relative;
        transition: transform 0.3s ease;
        cursor: pointer;
        z-index: 1;
      }

      img:hover {
        transform: scale(1.1);
      }
      .channel h2,
      .channel p {
        position: relative;
        z-index: 1;
      }
      .sub-diff-header {
        margin-bottom: 5px;
      }
      .sub-diff-number {
        margin-top: 0;
      }
      .odometer {
        font-size: 36px;
        font-weight: bold;
      }
      @media (max-width: 768px) {
        .channels {
          flex-direction: column;
        }
        .fullscreen {
          display: none !important;
        }
        .channel {
          width: 80%;
          margin: 0 auto 20px;
        }
      }
    </style>
  </head>
  <body>
    <h2>MrBeast vs Hamster Kombat Gains (Last 30 Days)</h2>
    <div class="channels">
      <div class="channel" data-channel="channel1">
        <canvas id="channel1-chart"></canvas>
        <img
          id="channel1-image"
          src=""
          alt="Channel 1 Thumbnail"
          crossorigin="anonymous"
        />
        <a id="channel1-link" href="#" target="_blank">
          <h2 id="channel1-name"></h2>
        </a>
        <p class="odometer" id="channel1-subs"></p>
      </div>
      <div class="channel" data-channel="channel2">
        <canvas id="channel2-chart"></canvas>
        <img
          id="channel2-image"
          src=""
          alt="Channel 2 Thumbnail"
          crossorigin="anonymous"
        />
        <a id="channel2-link" href="#" target="_blank">
          <h2 id="channel2-name"></h2>
        </a>
        <p class="odometer" id="channel2-subs"></p>
        <p
          class="odometer"
          id="channel2-real-subs"
          style="font-size: 24px; margin-top: -10px; visibility: hidden"
        ></p>
      </div>
    </div>
    <h2 class="sub-diff-header">Subscriber Difference</h2>
    <p class="sub-diff-number" id="sub-diff"></p>

    <h2 class="sub-diff-header">MrBeast Gains in the Last 24 Hours</h2>
    <p><span class="sub-diff-number" id="mrbeast-gains"></span></p>
    <br />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/odometer.js/0.4.8/odometer.min.js"></script>
    <script>
      const calcGrowth = (arr, len, dur, val) => {
        let realDate = true;
        let dates = [];
        let counts = [];
        if (realDate) {
          dates = arr.map((a) => new Date(a.last_updated).getTime());
          counts = arr.map((a) => a.previous_sub_count);
        }
        len = len ?? arr.length;
        dur = dur ?? len;

        if (!val) {
          if (realDate) {
            return arr.length < len
              ? Math.round(
                  ((counts.slice(-1)[0] - counts.slice(-Math.abs(len))[0]) /
                    ((dates.slice(-1)[0] - dates.slice(-Math.abs(len))[0]) / 1000)) *
                    dur
                )
              : counts.slice(-1)[0] - counts.slice(-Math.abs(len))[0];
          } else {
            return arr.length < len
              ? Math.round(
                  ((arr.slice(-1)[0] - arr.slice(-Math.abs(len))[0]) / arr.length) *
                    len
                )
              : arr.slice(-1)[0] - arr.slice(-Math.abs(len))[0];
          }
        } else {
          return ((arr.slice(-1)[0] - arr[0]) / arr.length) * val;
        }
      };

      function calcCurrentStats(sincePublished, compareTime, compareData) {
        let compareSincePublished = [];
        for (let i = 0; i < compareTime.length; i++) {
          compareSincePublished[i] = new Date(compareTime[i]).getTime() - new Date(compareTime[0]).getTime();
        }

        let preTime = compareSincePublished.filter(c => c < sincePublished).slice(-1)[0];
        let nextTime = compareSincePublished.filter(c => c >= sincePublished)[0];

        if (sincePublished > compareSincePublished.slice(-1)[0]) {
          preTime = compareSincePublished.slice(-2)[0];
          nextTime = compareSincePublished.slice(-1)[0];
        }

        let gapTime = nextTime - preTime;
        let progress = (sincePublished - preTime) / gapTime;

        let compareDataPre = compareData[compareSincePublished.indexOf(preTime)];
        let compareDataNext = compareData[compareSincePublished.indexOf(nextTime)];
        let compareDataPNgap = compareDataNext - compareDataPre;

        let compareCurCount = compareDataPre + (compareDataPNgap * progress);
        return Math.floor(compareCurCount);
      }

let mrbeastData;
let hamsterData;

function getAnalytics() {
  Promise.all([
    fetch("https://api.communitrics.com/mrbeast"),
    fetch("https://api.communitrics.com/UCozwejESfvl88CBBL0KgEhw"),
  ])
  .then((responses) => Promise.all(responses.map((res) => res.json())))
  .then((rawData) => {
    mrbeastData = rawData[0];
    hamsterData = rawData[1].data;
    hamsterHrGains = Math.round(rawData[1].channelDetails.mostRecentAverage / 24);
  });
}

function getData() {
  Promise.all([
    fetch("https://nia-statistics.com/api/get?platform=youtube&type=channel&id=UCX6OQ3DkcsbYNE6H8uQQuVA"),
    fetch("https://nia-statistics.com/api/get?platform=youtube&type=channel&id=UCozwejESfvl88CBBL0KgEhw")
  ])
  .then((responses) => Promise.all(responses.map((res) => res.json())))
  .then((rawData) => {
    let P30DTime = 30 * 24 * 60 * 60 * 1000;
    let P30DDate = Date.now() - P30DTime;
    let hamsterCreatedDate = new Date("2024-05-24T15:01:14.464999Z").getTime();
    let sinceCreated = Date.now() - hamsterCreatedDate;
    let past30Dtime = sinceCreated > P30DTime ? P30DDate : hamsterCreatedDate;
    let P30DDateString = new Date(Math.max(P30DDate, hamsterCreatedDate)).toISOString();
    let mrbeastCount = rawData[0].estSubCount;
    let hamsterCount = rawData[1].estSubCount;

    let mrbeastP30D = mrbeastData.reduce((prev, curr) => {
      return (Math.abs(new Date(curr?.currentTime).getTime() - past30Dtime) < Math.abs(new Date(prev?.currentTime).getTime() - past30Dtime) ? curr : prev);
    }, mrbeastData[0]);

    let mrbeastP30DSubCount = mrbeastP30D.count;

    if (sinceCreated > P30DTime) {
      mrbeastP30DSubCount = calcCurrentStats((Date.now() - new Date(mrbeastData[0].currentTime).getTime()) - P30DTime, mrbeastData.map(d => d.currentTime), mrbeastData.map(d => d.count));
    }

    let hamsterP30D = hamsterData.reduce((prev, curr) => {
      return (Math.abs(new Date(curr?.last_updated).getTime() - past30Dtime) < Math.abs(new Date(prev?.last_updated).getTime() - past30Dtime) ? curr : prev);
    }, hamsterData[0]);

    let hamsterP30DSubCount = 0;
    if (sinceCreated > P30DTime) {
      if (new Date(hamsterData[0].last_updated).getTime() > P30DDate) {
        hamsterP30DSubCount = Math.floor((sinceCreated - P30DTime) / (new Date(hamsterP30D.last_updated).getTime() - hamsterCreatedDate) * (hamsterP30D.previous_sub_count));
      } else {
        hamsterP30DSubCount = calcCurrentStats((Date.now() - new Date(hamsterData[0].last_updated).getTime()) - P30DTime, hamsterData.map(d => d.last_updated), hamsterData.map(d => d.previous_sub_count));
      }
    } else {
      hamsterP30DSubCount = 0;
    }

    updateUI({
      channel1: hamsterCount - hamsterP30DSubCount,
      channel2: mrbeastCount - mrbeastP30DSubCount
          });
        });
      }

      function updateUI(subCounts) {
        document.getElementById("channel1-subs").textContent = subCounts.channel1.toLocaleString("en-US");
        document.getElementById("channel2-subs").textContent = subCounts.channel2.toLocaleString("en-US");

        const subDiff = Math.abs(subCounts.channel1 - subCounts.channel2);
        odometerSubDiff.update(subDiff.toLocaleString("en-US"));

        const color1 = document.getElementById("channel1-subs").style.color;
        const color2 = document.getElementById("channel2-subs").style.color;
        document.getElementById("sub-diff").style.color = subCounts.channel1 > subCounts.channel2 ? color1 : color2;
      }

      document.addEventListener("DOMContentLoaded", function () {
        getAnalytics();
        getData();
        setInterval(getData, 30000);
      });

      const odometerSubDiff = new Odometer({
        el: document.getElementById("sub-diff"),
        value: 0,
        format: "(,ddd)",
        theme: "minimal",
      });
    </script>
  </body>
</html>
